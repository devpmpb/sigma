generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Bairro {
  id        Int        @id @default(autoincrement())
  nome      String     @unique
  ativo     Boolean    @default(true)
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  enderecos Endereco[]
}

model AreaRural {
  id        Int        @id @default(autoincrement())
  nome      String     @unique
  ativo     Boolean    @default(true)
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  enderecos Endereco[]
}

model Logradouro {
  id        Int            @id @default(autoincrement())
  tipo      TipoLogradouro
  descricao String
  cep       String?        @unique
  ativo     Boolean        @default(true)
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt
  enderecos Endereco[]
}

model GrupoProduto {
  id        Int      @id @default(autoincrement())
  descricao String   @unique
  ativo     Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model TipoVeiculo {
  id        Int       @id @default(autoincrement())
  descricao String    @unique
  ativo     Boolean   @default(true)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  veiculos  Veiculo[]
}

model Veiculo {
  id            Int            @id @default(autoincrement())
  tipoVeiculoId Int
  descricao     String
  placa         String         @unique
  ativo         Boolean        @default(true)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  tipoVeiculo   TipoVeiculo    @relation(fields: [tipoVeiculoId], references: [id])
  ordensServico OrdemServico[]
}

model Pessoa {
  id                             Int                        @id @default(autoincrement())
  tipoPessoa                     TipoPessoa
  nome                           String
  cpfCnpj                        String                     @unique
  telefone                       String?
  email                          String?
  ativo                          Boolean                    @default(true)
  isProdutor                     Boolean?                   @default(false)
  inscricaoEstadualProdutor      String?
  createdAt                      DateTime                   @default(now())
  updatedAt                      DateTime                   @updatedAt
  areasEfetivas                  AreaEfetiva[]
  arrendamentos                  Arrendamento[]             @relation("arrendatario")
  arrendou                       Arrendamento[]             @relation("proprietario")
  enderecos                      Endereco[]
  pessoaFisica                   PessoaFisica?
  pessoaJuridica                 PessoaJuridica?
  propriedadesComoNuProprietario Propriedade[]              @relation("NuProprietario")
  propriedades                   Propriedade[]
  condominios                    PropriedadeCondomino[]     @relation("PropriedadeCondominos")
  solicitacoesBeneficio          SolicitacaoBeneficio[]
  telefones                      Telefone[]
  ordensServico                  OrdemServico[]
  transferenciasComoNuNovo       TransferenciaPropriedade[] @relation("TransferenciaNuProprietarioNovo")
  transferenciasComoAnterior     TransferenciaPropriedade[] @relation("TransferenciaProprietarioAnterior")
  transferenciasComoNovo         TransferenciaPropriedade[] @relation("TransferenciaProprietarioNovo")
}

model PessoaFisica {
  id             Int       @id
  rg             String?
  dataNascimento DateTime?
  pessoa         Pessoa    @relation(fields: [id], references: [id])
}

model PessoaJuridica {
  id                 Int       @id
  nomeFantasia       String?
  inscricaoEstadual  String?
  inscricaoMunicipal String?
  dataFundacao       DateTime?
  representanteLegal String?
  pessoa             Pessoa    @relation(fields: [id], references: [id])
}

model Telefone {
  id        Int          @id @default(autoincrement())
  pessoaId  Int
  ddd       String?
  numero    String
  ramal     String?
  tipo      TipoTelefone @default(CELULAR)
  principal Boolean      @default(false)
  ativo     Boolean      @default(true)
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
  pessoa    Pessoa       @relation(fields: [pessoaId], references: [id], onDelete: Cascade)

  @@index([pessoaId])
  @@index([pessoaId, principal])
}

model Endereco {
  id              Int           @id @default(autoincrement())
  pessoaId        Int
  logradouroId    Int?
  numero          String?
  complemento     String?
  bairroId        Int?
  areaRuralId     Int?
  referenciaRural String?
  coordenadas     String?
  tipoEndereco    TipoEndereco
  principal       Boolean       @default(false)
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  areaRural       AreaRural?    @relation(fields: [areaRuralId], references: [id])
  bairro          Bairro?       @relation(fields: [bairroId], references: [id])
  logradouro      Logradouro?   @relation(fields: [logradouroId], references: [id])
  pessoa          Pessoa        @relation(fields: [pessoaId], references: [id])
  propriedades    Propriedade[]
}

model AreaEfetiva {
  id                    Int                 @id @default(autoincrement())
  pessoaId              Int
  anoReferencia         Int
  areaPropria           Decimal             @default(0) @db.Decimal(10, 2)
  areaArrendadaRecebida Decimal             @default(0) @db.Decimal(10, 2)
  areaArrendadaCedida   Decimal             @default(0) @db.Decimal(10, 2)
  areaEfetiva           Decimal             @default(0) @db.Decimal(10, 2)
  atividadeProdutiva    AtividadeProdutiva?
  ramoAtividadeId       Int?
  updatedAt             DateTime            @default(now()) @updatedAt
  pessoa                Pessoa              @relation(fields: [pessoaId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  ramoAtividade         RamoAtividade?      @relation(fields: [ramoAtividadeId], references: [id], onUpdate: NoAction)

  @@unique([pessoaId, anoReferencia])
  @@index([pessoaId])
  @@index([ramoAtividadeId])
  @@index([anoReferencia])
}

model Propriedade {
  id                      Int                        @id @default(autoincrement())
  nome                    String
  tipoPropriedade         TipoPropriedade            @default(RURAL)
  numero                  String?
  areaTotal               Decimal                    @db.Decimal(10, 2)
  unidadeArea             String                     @default("alqueires")
  itr                     String?
  incra                   String?
  atividadeProdutiva      AtividadeProdutiva?
  situacao                SituacaoPropriedade
  isproprietarioResidente Boolean                    @default(false)
  localizacao             String?
  matricula               String?
  proprietarioId          Int
  nuProprietarioId        Int?
  createdAt               DateTime                   @default(now())
  updatedAt               DateTime                   @updatedAt
  enderecoId              Int?
  arrendamentos           Arrendamento[]
  endereco                Endereco?                  @relation(fields: [enderecoId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  nuProprietario          Pessoa?                    @relation("NuProprietario", fields: [nuProprietarioId], references: [id])
  proprietario            Pessoa                     @relation(fields: [proprietarioId], references: [id])
  condominos              PropriedadeCondomino[]
  transferencias          TransferenciaPropriedade[]
}

model TransferenciaPropriedade {
  id                     Int                 @id @default(autoincrement())
  propriedadeId          Int                 @map("propriedade_id")
  proprietarioAnteriorId Int                 @map("proprietario_anterior_id")
  proprietarioNovoId     Int                 @map("proprietario_novo_id")
  dataTransferencia      DateTime            @map("data_transferencia") @db.Date
  observacoes            String?
  createdAt              DateTime            @default(now()) @map("created_at")
  updatedAt              DateTime            @updatedAt @map("updated_at")
  nuProprietarioNovoId   Int?                @map("nu_proprietario_novo_id")
  situacaoPropriedade    SituacaoPropriedade @default(PROPRIA) @map("situacao_propriedade")
  nuProprietarioNovo     Pessoa?             @relation("TransferenciaNuProprietarioNovo", fields: [nuProprietarioNovoId], references: [id])
  propriedade            Propriedade         @relation(fields: [propriedadeId], references: [id])
  proprietarioAnterior   Pessoa              @relation("TransferenciaProprietarioAnterior", fields: [proprietarioAnteriorId], references: [id])
  proprietarioNovo       Pessoa              @relation("TransferenciaProprietarioNovo", fields: [proprietarioNovoId], references: [id])

  @@index([propriedadeId])
  @@index([dataTransferencia])
  @@map("transferencias_propriedade")
}

model PropriedadeCondomino {
  id            Int         @id(map: "propriedades_condominos_pkey") @default(autoincrement())
  propriedadeId Int         @map("propriedade_id")
  condominoId   Int         @map("condomino_id")
  percentual    Decimal?    @db.Decimal(5, 2)
  dataInicio    DateTime    @default(now()) @map("data_inicio")
  dataFim       DateTime?   @map("data_fim")
  observacoes   String?
  createdAt     DateTime    @default(now()) @map("created_at")
  updatedAt     DateTime    @updatedAt @map("updated_at")
  condomino     Pessoa      @relation("PropriedadeCondominos", fields: [condominoId], references: [id], map: "propriedades_condominos_condomino_id_fkey")
  propriedade   Propriedade @relation(fields: [propriedadeId], references: [id], onDelete: Cascade, map: "propriedades_condominos_propriedade_id_fkey")

  @@unique([propriedadeId, condominoId, dataFim], map: "propriedades_condominos_propriedade_id_condomino_id_data_fi_key")
  @@index([condominoId], map: "propriedades_condominos_condomino_id_idx")
  @@index([propriedadeId], map: "propriedades_condominos_propriedade_id_idx")
  @@map("PropriedadeCondomino")
}

model Arrendamento {
  id                 Int                 @id @default(autoincrement())
  propriedadeId      Int
  proprietarioId     Int
  arrendatarioId     Int
  areaArrendada      Decimal             @db.Decimal(10, 2)
  dataInicio         DateTime
  dataFim            DateTime?
  status             String              @default("ativo")
  documentoUrl       String?
  residente          Boolean             @default(false)
  atividadeProdutiva AtividadeProdutiva?
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  arrendatario       Pessoa              @relation("arrendatario", fields: [arrendatarioId], references: [id])
  propriedade        Propriedade         @relation(fields: [propriedadeId], references: [id])
  proprietario       Pessoa              @relation("proprietario", fields: [proprietarioId], references: [id])
}

model SolicitacaoBeneficio {
  id                   Int                    @id @default(autoincrement())
  pessoaId             Int
  programaId           Int
  datasolicitacao      DateTime               @default(now())
  status               String                 @default("pendente")
  observacoes          String?
  modalidade           String?                // APLICACAO_SUBSIDIADA, RETIRADA_SEMEN, REEMBOLSO, etc.
  createdAt            DateTime               @default(now())
  updatedAt            DateTime               @updatedAt
  calculoDetalhes      Json?
  quantidadeSolicitada Decimal?               @db.Decimal(10, 2)
  regraAplicadaId      Int?
  valorCalculado       Decimal?               @db.Decimal(10, 2)
  enquadramento        String?
  pessoa               Pessoa                 @relation(fields: [pessoaId], references: [id])
  programa             Programa               @relation(fields: [programaId], references: [id])
  regraAplicada        RegrasNegocio?         @relation(fields: [regraAplicadaId], references: [id])
  historico            HistoricoSolicitacao[]
}

model RamoAtividade {
  id            Int                     @id @default(autoincrement())
  nome          String                  @unique
  descricao     String?
  categoria     AtividadeProdutiva
  ativo         Boolean                 @default(true)
  createdAt     DateTime                @default(now())
  updatedAt     DateTime                @updatedAt
  areasEfetivas AreaEfetiva[]
  programas     ProgramaRamoAtividade[]

  @@index([categoria])
  @@index([ativo])
}

model Programa {
  id                  Int                     @id @default(autoincrement())
  nome                String
  descricao           String?
  leiNumero           String?
  tipoPrograma        TipoPrograma
  secretaria          TipoPerfil
  ativo               Boolean                 @default(true)
  createdAt           DateTime                @default(now())
  updatedAt           DateTime                @updatedAt
  periodicidade       Periodicidade           @default(ANUAL)
  unidadeLimite       String?                 @db.VarChar(50)
  limiteMaximoFamilia Decimal?                @db.Decimal(10, 2)
  ramosAtividade      ProgramaRamoAtividade[]
  regras              RegrasNegocio[]
  solicitacoes        SolicitacaoBeneficio[]

  @@index([periodicidade])
}

model ProgramaRamoAtividade {
  programaId      Int
  ramoAtividadeId Int
  createdAt       DateTime      @default(now())
  programa        Programa      @relation(fields: [programaId], references: [id], onDelete: Cascade)
  ramoAtividade   RamoAtividade @relation(fields: [ramoAtividadeId], references: [id], onDelete: Cascade)

  @@id([programaId, ramoAtividadeId])
  @@index([programaId])
  @@index([ramoAtividadeId])
}

model RegrasNegocio {
  id              Int                    @id @default(autoincrement())
  programaId      Int
  tipoRegra       String
  parametro       Json
  valorBeneficio  Decimal                @db.Decimal(10, 2)
  limiteBeneficio Json?
  createdAt       DateTime               @default(now())
  updatedAt       DateTime               @updatedAt
  programa        Programa               @relation(fields: [programaId], references: [id])
  solicitacoes    SolicitacaoBeneficio[]
}

model HistoricoSolicitacao {
  id             Int                  @id @default(autoincrement())
  solicitacaoId  Int
  statusAnterior String?
  statusNovo     String
  usuarioId      Int?
  motivo         String?
  observacoes    String?
  createdAt      DateTime             @default(now())
  solicitacao    SolicitacaoBeneficio @relation(fields: [solicitacaoId], references: [id], onDelete: Cascade)

  @@index([solicitacaoId])
  @@index([createdAt])
  @@map("historico_solicitacoes")
}

model TipoServico {
  id          Int                 @id @default(autoincrement())
  nome        String              @unique
  unidade     String
  ativo       Boolean             @default(true)
  createdAt   DateTime            @default(now())
  updatedAt   DateTime            @updatedAt
  faixasPreco FaixaPrecoServico[]
  ordens      OrdemServico[]

  @@map("tipos_servico")
}

model FaixaPrecoServico {
  id              Int         @id @default(autoincrement())
  tipoServicoId   Int
  quantidadeMin   Int
  quantidadeMax   Int?
  multiplicadorVR Decimal     @db.Decimal(4, 2)
  ativo           Boolean     @default(true)
  vigenciaInicio  DateTime    @default(now())
  vigenciaFim     DateTime?
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  tipoServico     TipoServico @relation(fields: [tipoServicoId], references: [id], onDelete: Cascade)

  @@index([tipoServicoId])
  @@map("faixas_preco_servico")
}

model OrdemServico {
  id                   Int         @id @default(autoincrement())
  numeroOrdem          String      @unique
  pessoaId             Int
  veiculoId            Int
  dataServico          DateTime
  horaInicio           String?
  horaFim              String?
  valorReferencial     Decimal     @default(180.00) @db.Decimal(10, 2)
  valorCalculado       Decimal     @db.Decimal(10, 2)
  observacoes          String?
  status               String      @default("pendente")
  usuarioId            Int?
  enderecoServico      String?
  createdAt            DateTime    @default(now())
  updatedAt            DateTime    @updatedAt
  tipoServicoId        Int
  quantidadeSolicitada Decimal     @db.Decimal(6, 2)
  pessoa               Pessoa      @relation(fields: [pessoaId], references: [id])
  tipoServico          TipoServico @relation(fields: [tipoServicoId], references: [id])
  veiculo              Veiculo     @relation(fields: [veiculoId], references: [id])

  @@index([tipoServicoId])
  @@map("ordens_servico")
}

model Usuario {
  id              Int             @id @default(autoincrement())
  nome            String
  email           String          @unique
  senha           String
  ativo           Boolean         @default(true)
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  perfilId        Int
  ultimoLogin     DateTime?
  tentativasLogin Int             @default(0)
  bloqueadoAte    DateTime?
  perfil          Perfil          @relation(fields: [perfilId], references: [id])
  sessoes         UsuarioSessao[]
}

model Perfil {
  id         Int               @id @default(autoincrement())
  nome       TipoPerfil        @unique
  descricao  String?
  ativo      Boolean           @default(true)
  createdAt  DateTime          @default(now())
  updatedAt  DateTime          @updatedAt
  permissoes PerfilPermissao[]
  usuarios   Usuario[]
}

model Permissao {
  id        Int               @id @default(autoincrement())
  modulo    ModuloSistema
  acao      AcaoPermissao
  descricao String?
  ativo     Boolean           @default(true)
  createdAt DateTime          @default(now())
  updatedAt DateTime          @updatedAt
  perfis    PerfilPermissao[]

  @@unique([modulo, acao])
}

model PerfilPermissao {
  id          Int       @id @default(autoincrement())
  perfilId    Int
  permissaoId Int
  createdAt   DateTime  @default(now())
  perfil      Perfil    @relation(fields: [perfilId], references: [id])
  permissao   Permissao @relation(fields: [permissaoId], references: [id])

  @@unique([perfilId, permissaoId])
}

model UsuarioSessao {
  id           Int       @id @default(autoincrement())
  usuarioId    Int
  token        String    @unique
  refreshToken String?   @unique
  expiresAt    DateTime
  createdAt    DateTime  @default(now())
  revokedAt    DateTime?
  ipAddress    String?
  userAgent    String?
  usuario      Usuario   @relation(fields: [usuarioId], references: [id])
}

model AuditoriaLogin {
  id        Int      @id @default(autoincrement())
  email     String
  sucesso   Boolean
  ipAddress String?
  userAgent String?
  motivo    String?
  createdAt DateTime @default(now())
}

/// The underlying table does not contain a valid unique identifier and can therefore currently not be handled by Prisma Client.
model v_programas_gim {
  count BigInt?

  @@ignore
}

enum TipoEndereco {
  RESIDENCIAL
  COMERCIAL
  RURAL
  CORRESPONDENCIA
}

enum TipoLogradouro {
  RUA
  AVENIDA
  TRAVESSA
  ALAMEDA
  RODOVIA
  LINHA
  ESTRADA
  OUTROS
}

enum TipoPropriedade {
  RURAL
  LOTE_URBANO
  COMERCIAL
  INDUSTRIAL
}

enum TipoPessoa {
  FISICA
  JURIDICA
}

enum SituacaoPropriedade {
  PROPRIA
  CONDOMINIO
  USUFRUTO
}

enum TipoPerfil {
  ADMIN
  OBRAS
  AGRICULTURA
}

enum ModuloSistema {
  OBRAS
  AGRICULTURA
  COMUM
  ADMIN
}

enum AcaoPermissao {
  VIEW
  CREATE
  EDIT
  DELETE
}

enum TipoPrograma {
  SUBSIDIO
  MATERIAL
  SERVICO
  CREDITO
  ASSISTENCIA
}

enum AtividadeProdutiva {
  AGRICULTURA
  PECUARIA
  AGRICULTURA_PECUARIA
  SILVICULTURA
  AQUICULTURA
  HORTIFRUTI
  AVICULTURA
  SUINOCULTURA
  OUTROS
}

enum TipoTelefone {
  CELULAR
  RESIDENCIAL
  COMERCIAL
  OUTRO
}

enum Periodicidade {
  ANUAL
  BIENAL
  TRIENAL
  UNICO
}
